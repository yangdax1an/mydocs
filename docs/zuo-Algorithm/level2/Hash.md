# 哈希

## 认识哈希函数和哈希表的实现

### 什么是哈希函数

#### 第一个特点：范围

$out F (in)$是一个函数，其中in是输入，F是哈希函数，out是输出。

1. $in：$输入域是无穷的
2. $out：$输出域是有限的

典型的哈希函数：`MD5算法`和`SHA1算法`

MD5：输出范围为0 ~2^64  -1

SHA1：输出范围为0 ~2^128  -1

比如我们常见的链接码，就是一个16进制的哈希值：1159798e67f9a6d001d16508ef7a5643

而这个值的大小就是在哈希函数的输出范围内，因此哈希函数的输出是有限的

因此MD5会返回一个长度为16的字符串，而SHA1会返回一个长度32的字符串。

#### 第二个特点：same in -> same out

相同的输入进入哈希函数会得到相同的输出，意味着哈希函数**没有任何随机**的成分

#### 第三个特点：diff in -> same out（哈希碰撞）

虽然会有碰撞的可能性，但是概率非常非常小，比如你从**出生的那一刻开始**，每秒钟随机生成10个字符串，利用`MD5算法`进行哈希值计算，到**你死亡的那一刻结束**，产生过至少一次碰撞的概率，和被多次雷劈中还活下来的概率差不多。因此选择合适的哈希函数可以有效规避哈希碰撞的可能性。

#### 第四个特点：离散性和均匀性

1. **离散性**：相同的两个字符串，其中一个随机改变一个字母，产生出来的两个值差别十分大。
2. **均匀性**：在一个大量哈希值生成的范围内，用相同的尺度去截取其中的内容，尺度中得到的节点数量差不多。不会出现集中分布的情况。

![](./media/hash-1.png)

一个哈希函数的离散性越好越优秀。

### 使用哈希函数

1. 所有的`输入in`通过相同的`哈希函数f`得到**均匀**的`输出S`
2. **均匀**的输出S通过**模运算**$\%m$得到**最终输出**O，O的范围是$[0,m-1]$

因为S是均匀分布的，因此O也是均匀分布的。因为O的范围太大了，我们可以通过m的值来得到我们先要范围内的哈希值。

![](./media/hash-2.png)

## 题目：1G内存找40亿数中出现次数最多的数
![](./media/hash-3.png)

有一个巨大的文件，里面存储了**40亿个**无符号整数，其中一个数的数据范围是[0,2^32-1]，限制只有**一个G**内存，找出其中出现次数最多的数，该如何做？

* 如果我们忽略内存限制，则可以使用哈希表进行计算：

HashMap	key（int） value（出现次数）

因为一条记录至少为4B+4B=**8Byte**，因此40亿条记录至少需要320亿Byte=**32G**内存

* 将这40亿个数通过哈希函数分类，离散到100个文件里面去，再对这100个小文件使用哈希表计算出现最多的数，再把这100个筛选出来的数再筛选，得到最后的答案

  ![](./media/hash-4.png)

因为相同的数一定会进入相同的文件，并且分成100份小文件之后，小文件之间也可以保证均分

 
